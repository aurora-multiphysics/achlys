<!DOCTYPE html><head><meta charset="UTF-8"><title>Input file preparation | Achlys</title><link href="../../../contrib/materialize/materialize.min.css" type="text/css" rel="stylesheet" media="screen,projection"></link><link href="../../../contrib/prism/prism.min.css" type="text/css" rel="stylesheet"></link><link href="../../../css/moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/devel_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/alert_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/content_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/sqa_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../css/civet_moose.css" type="text/css" rel="stylesheet"></link><link href="../../../contrib/katex/katex.min.css" type="text/css" rel="stylesheet"></link><link href="../../../css/katex_moose.css" type="text/css" rel="stylesheet"></link><script type="text/javascript" src="../../../contrib/jquery/jquery.min.js"></script><script type="text/javascript" src="../../../contrib/katex/katex.min.js"></script></head><body><div class="page-wrap"><header><nav><div class="nav-wrapper container"><a href="../../../index.html" class="left moose-logo hide-on-med-and-down">Achlys</a><ul class="right hide-on-med-and-down"><li class="moose-mega-menu-trigger" data-target="ba43922b-1f04-43f2-ab9c-16e22b832190"><a>Documentation<i class="material-icons right">arrow_drop_down</i></a></li><li class="moose-mega-menu-trigger" data-target="e1ca13ab-166b-450e-92aa-e5de8690d8a0"><a>Examples<i class="material-icons right">arrow_drop_down</i></a></li><li class="moose-mega-menu-trigger" data-target="66ba80e8-5c38-4573-bf43-7996b307236f"><a>Source code<i class="material-icons right">arrow_drop_down</i></a></li></ul><a href="#" class="sidenav-trigger" data-target="c35bde80-176a-49b5-8446-30e934fafc82"><i class="material-icons">menu</i></a><ul class="sidenav" id="c35bde80-176a-49b5-8446-30e934fafc82"><li><a href="../../../documentation.menu.html">Documentation</a></li><li><a href="../../../examples.menu.html">Examples</a></li><li><a href="../../../source_code.menu.html">Source code</a></li></ul><a href="#moose-search" class="modal-trigger"><i class="material-icons">search</i></a></div></nav><div class="moose-mega-menu-content" id="ba43922b-1f04-43f2-ab9c-16e22b832190"><div class="moose-mega-menu-wrapper"><div class="row row"><div class="col s12 m6 l4"><h2><a href="../../index.html">Module <i class="material-icons moose-inline-icon">link</i></a></h2><p>  </p><ul class="browser-default"><li><p><a href="../../introduction.html">Introdcution and Theory</a></p></li></ul><p></p></div><div class="col s12 m6 l4"><h2><a href="../index.html">Examples <i class="material-icons moose-inline-icon">link</i></a></h2><ul class="browser-default"><li><p><a href="../analytical/index.html">Comparison to Analytical Solution</a> </p></li><li><p><a href="index.html">Thermal Desorption Spectrum</a></p></li></ul><p></p></div><div class="col s12 m6 l4"><h2><a href="../../../source/index.html">Source Code <i class="material-icons moose-inline-icon">link</i></a></h2><ul class="browser-default"><li><p><a href="../../../source/kernels/index.html">kernels</a> </p></li><li><p><a href="../../../source/bcs/index.html">bcs</a> </p></li><li><p><a href="../../../source/materials/index.html">materials</a> </p></li><li><p><a href="../../../source/postprocessors/index.html">postprocessors</a></p></li></ul><p></p></div><p> </p><p>  </p><p></p><p>    </p><p></p><p></p></div><p>  </p></div></div><div class="moose-mega-menu-content" id="e1ca13ab-166b-450e-92aa-e5de8690d8a0"><div class="moose-mega-menu-wrapper"><div class="row row"><div class="col s12 m6 l4"><h2><a href="../analytical/index.html">Comparison to Analytical Solution <i class="material-icons moose-inline-icon">link</i></a></h2><ul class="browser-default"><li><p><a href="../analytical/analytical.html">Overview</a> </p></li><li><p><a href="../analytical/input_files.html">Input preparation</a></p></li></ul><p></p></div><div class="col s12 m6 l4"><h2><a href="index.html">Thermal Desorption Spectrum <i class="material-icons moose-inline-icon">link</i></a></h2><ul class="browser-default"><li><p><a href="index.html">Overview</a> </p></li><li><p><a href="extrinsic_traps.html">Additional theory</a> </p></li><li><p><a href="input_files.html">Preparing the simulation</a></p></li></ul><p></p></div><p></p></div></div></div><div class="moose-mega-menu-content" id="66ba80e8-5c38-4573-bf43-7996b307236f"><div class="moose-mega-menu-wrapper"><div class="row row"><div class="col s12 m6 l4"><h2><a href="../../../source/kernels/index.html">Kernels <i class="material-icons moose-inline-icon">link</i></a></h2><p>  </p><h2><a href="../../../source/bcs/index.html">BCs <i class="material-icons moose-inline-icon">link</i></a></h2><p></p></div><div class="col s12 m6 l4"><h2><a href="../../../source/materials/index.html">Materials <i class="material-icons moose-inline-icon">link</i></a></h2><p>   </p><p></p></div><div class="col s12 m6 l4"><h2><a href="../../../source/postprocessors/index.html">Postprocessors <i class="material-icons moose-inline-icon">link</i></a></h2><p>  </p><p></p><p>    </p><p></p></div><p></p></div><p>  </p></div></div><div class="modal modal-fixed-footer moose-search-modal" id="moose-search"><div class="modal-content container moose-search-modal-content"><div class="row"><div class="col l12"><div class="input-field"><input type_="text" onkeyup="mooseSearch()" placeholder="/index.md" id="moose-search-box"></input></div></div><div><div class="col s12" id="moose-search-results"></div></div></div></div><div class="modal-footer"><a href="#!" class="modal-close btn-flat">Close</a></div></div></header><main class="main"><div class="container"><div class="row"><div class="col hide-on-med-and-down l12"><nav class="breadcrumb-nav"><div class="nav-wrapper"><a href="../.." class="breadcrumb">module</a><a href=".." class="breadcrumb">examples</a><a href="." class="breadcrumb">thermal_desorption</a><a href="#" class="breadcrumb">input_files</a></div></nav></div></div><div class="row"><div class="moose-content col s12 m12 l10"><p>Links to other pages for this example : - <a href="index.html">Overview</a> - <a href="extrinsic_traps.html">Additional theory</a> - <a href="input_files.html">Preparing the simulation</a></p><section id="d8895dd8-0661-43d3-9183-7e7dead9bd1f" data-section-level="1" data-section-text="Input file preparation"><h1 id="input-file-preparation">Input file preparation</h1><p>This calculation is carried out in 3 stages</p><ul class="browser-default"><li><p><a href="input_files.html#implantation">Implantation</a>: the material sample is bombarded with deuterium ions at constant temperature </p></li><li><p><a href="input_files.html#resting">Resting</a>: the source term is switched off, slow off-gassing occurs due to the low temperature </p></li><li><p><a href="input_files.html#desorption">Desorption</a>: Temperature is raised at a constant rate and the rate of desorption is measured from each surface</p></li></ul><section class="scrollspy" id="c78e5c08-9f0b-4049-9856-32a42a4e648d" data-section-level="2" data-section-text="Multiapp"><h2 id="multiapp">Multiapp</h2><p>For this example a multiapp structure has been used to combine the three simulation steps.  The final, desorption step is the dominant process and each simulation step launches the step  which precedes it before beginning its own calculation.  The transfer block is used to copy the results from variables in sub-app calculations back to the calling app.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;resting_multi.i&#x27;
    # positions = &#x27;0   0.029   0
    #              0.015 0.0.029 0
    #              0.015 0.014 0
    #              0.0 0.014 0&#x27;
    execute_on = INITIAL
    clone_master_mesh = true
  []
[]

[Transfers]
  #   [to_sub] 
  #    type = MultiAppCopyTransfer
  #    multi_app = sub_app
  #    source_variable = &#x27;surface_temp&#x27;
  #    variable = &#x27;surface_temp&#x27;
  #    direction = to_multiapp
  #  []
  [mobile_transfer]
    type = MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type = MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type = MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type = MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#61fae360-9d80-47b9-b8b3-a1b92eda2e2b">(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</a></section><section class="scrollspy" id="875e0d61-f6ef-4cbd-b717-df353dfb8845" data-section-level="2" data-section-text="Common parameters"><h2 id="common-parameters">Common parameters</h2><p>The parameters used for this example have been taken from <a href="#DELAPORTE2019">Delaporte-Mathurin et al. (2019)</a>,  the experimental set-up follows <a href="#OGOROD2003">Ogorodnikova et al. (2003)</a></p><div class="card moose-float"><div class="card-content"><p class="moose-caption"><span class="moose-caption-heading">Table 1: </span><span class="moose-caption-text">Example innput parameters</span></p><div form="['left', 'left', 'left', 'left']" recursive class="moose-table-div"><table><thead><tr><th style=";text-align:left">parameter name</th><th style=";text-align:left">symbol</th><th style=";text-align:left">value</th><th style=";text-align:left">Unit</th></tr></thead><tbody><tr><td style=";text-align:left">Density</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-0dc8d9b3-7b46-4e56-a846-ffe0dbe42cb1"><script>var element = document.getElementById("moose-equation-0dc8d9b3-7b46-4e56-a846-ffe0dbe42cb1");katex.render("\\rho", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-7b48e80a-9714-45fb-a856-300daba7cffc"><script>var element = document.getElementById("moose-equation-7b48e80a-9714-45fb-a856-300daba7cffc");katex.render("6.3 \\times 10^{28}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-1347208c-0a6c-498d-a641-7766a6916583"><script>var element = document.getElementById("moose-equation-1347208c-0a6c-498d-a641-7766a6916583");katex.render("m^{-3}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Lattice sites</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-b28a07a9-5d8b-4ba0-9910-b1cbf687ee9a"><script>var element = document.getElementById("moose-equation-b28a07a9-5d8b-4ba0-9910-b1cbf687ee9a");katex.render("N_{\\text{sol}}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-a3b69906-37d6-4d6e-adff-8b171e091219"><script>var element = document.getElementById("moose-equation-a3b69906-37d6-4d6e-adff-8b171e091219");katex.render("2.0 \\rho", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-982d96ba-1a45-459d-be31-06fc7beabd00"><script>var element = document.getElementById("moose-equation-982d96ba-1a45-459d-be31-06fc7beabd00");katex.render("m^{-3}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Trap Density (low energy intrinsic)</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-c868ca5d-a5b0-4f9e-84af-c9cc0ce5ead9"><script>var element = document.getElementById("moose-equation-c868ca5d-a5b0-4f9e-84af-c9cc0ce5ead9");katex.render("n_1", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-ddfce41d-14b5-4422-8250-0cd72a652084"><script>var element = document.getElementById("moose-equation-ddfce41d-14b5-4422-8250-0cd72a652084");katex.render("1.00\\times 10^{-3}\\rho", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-0e573056-029e-42e4-b5dc-f34ff1e9db87"><script>var element = document.getElementById("moose-equation-0e573056-029e-42e4-b5dc-f34ff1e9db87");katex.render("m^{-3}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Trap Density (high energy intrinsic)</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-955429e0-4033-4398-b644-ea3b7ab34268"><script>var element = document.getElementById("moose-equation-955429e0-4033-4398-b644-ea3b7ab34268");katex.render("n_2", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-28842896-ede9-48c8-a326-6205af9b82fc"><script>var element = document.getElementById("moose-equation-28842896-ede9-48c8-a326-6205af9b82fc");katex.render("1.00\\times 10^{-4}\\rho", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-d4f6e74a-4470-4940-b874-244970b3de67"><script>var element = document.getElementById("moose-equation-d4f6e74a-4470-4940-b874-244970b3de67");katex.render("m^{-3}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Maximum extrinsic trap Density type a</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-1dae8db2-e18b-4876-bb98-a31ecd0a6ad4"><script>var element = document.getElementById("moose-equation-1dae8db2-e18b-4876-bb98-a31ecd0a6ad4");katex.render("n_{3a\\_max}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-53ed1632-f885-4ce9-a665-201bf8fc1c8b"><script>var element = document.getElementById("moose-equation-53ed1632-f885-4ce9-a665-201bf8fc1c8b");katex.render("1.00\\times 10^{-1}\\rho", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-7d6e1dad-418f-4bca-8e69-76e132a6255a"><script>var element = document.getElementById("moose-equation-7d6e1dad-418f-4bca-8e69-76e132a6255a");katex.render("m^{-3}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Maximum extrinsic trap Density type b</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-c3934cc9-d1e6-4dee-95a6-377f992fbb86"><script>var element = document.getElementById("moose-equation-c3934cc9-d1e6-4dee-95a6-377f992fbb86");katex.render("n_{3b\\_max}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-7b87ac3e-3e8c-4ce5-9df9-5751964ea24b"><script>var element = document.getElementById("moose-equation-7b87ac3e-3e8c-4ce5-9df9-5751964ea24b");katex.render("1.00\\times 10^{-3}\\rho", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-579a7141-5082-42db-85c8-af0d68dd0335"><script>var element = document.getElementById("moose-equation-579a7141-5082-42db-85c8-af0d68dd0335");katex.render("m^{-3}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Diffusion rate pre-exponential factor</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-0cf1a6ec-5d45-45db-9755-ca2d4b38a3a8"><script>var element = document.getElementById("moose-equation-0cf1a6ec-5d45-45db-9755-ca2d4b38a3a8");katex.render("D_0", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-9aef4537-67f3-4724-896c-679655c62698"><script>var element = document.getElementById("moose-equation-9aef4537-67f3-4724-896c-679655c62698");katex.render("1.00\\times 10^{-7}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-b9337936-4f11-4321-8156-1a7409deaab3"><script>var element = document.getElementById("moose-equation-b9337936-4f11-4321-8156-1a7409deaab3");katex.render("m^{2}s^{-1}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Diffusion Energy</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-346b08a4-59f7-4884-acb1-3cfd0b1f3e9a"><script>var element = document.getElementById("moose-equation-346b08a4-59f7-4884-acb1-3cfd0b1f3e9a");katex.render("E_{\\text{diff}}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left">0.39</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-1b4916ab-a8dc-4034-8370-26141517a87c"><script>var element = document.getElementById("moose-equation-1b4916ab-a8dc-4034-8370-26141517a87c");katex.render("eV", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Lattice constant</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-2f616d42-e966-4c83-83eb-7d1474c46159"><script>var element = document.getElementById("moose-equation-2f616d42-e966-4c83-83eb-7d1474c46159");katex.render("\\lambda", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-8657099a-0f97-46d8-ae5c-3984a9b0159d"><script>var element = document.getElementById("moose-equation-8657099a-0f97-46d8-ae5c-3984a9b0159d");katex.render("1\\times 10^{-9}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-cdb6aef1-325c-48fd-8ffb-a397ef36c30b"><script>var element = document.getElementById("moose-equation-cdb6aef1-325c-48fd-8ffb-a397ef36c30b");katex.render("m", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">De-trapping pre-exponential factor (all traps)</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-b55e031f-4e7e-4e17-b19b-889b4d724d23"><script>var element = document.getElementById("moose-equation-b55e031f-4e7e-4e17-b19b-889b4d724d23");katex.render("\\nu_{1,2,3}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-f12a9869-7e71-4571-b968-28038594f42c"><script>var element = document.getElementById("moose-equation-f12a9869-7e71-4571-b968-28038594f42c");katex.render("1.0\\times 10^{-13}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-0a74a1d5-0003-4ad7-8350-c78c0186c6a1"><script>var element = document.getElementById("moose-equation-0a74a1d5-0003-4ad7-8350-c78c0186c6a1");katex.render("s^{-1}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">De-trapping Energy, trap 1</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-fa4847c5-2ed9-49e4-8f77-48e7b148ed5d"><script>var element = document.getElementById("moose-equation-fa4847c5-2ed9-49e4-8f77-48e7b148ed5d");katex.render("E_{1}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-fde47858-62b1-4cb7-bd34-844504fce39f"><script>var element = document.getElementById("moose-equation-fde47858-62b1-4cb7-bd34-844504fce39f");katex.render("0.85", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-0e0ba131-1bf4-4043-9fb1-3f8b9ccd4599"><script>var element = document.getElementById("moose-equation-0e0ba131-1bf4-4043-9fb1-3f8b9ccd4599");katex.render("eV", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">De-trapping Energy, trap 2</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-25ae0286-22c6-4213-8d29-990f72f8df3e"><script>var element = document.getElementById("moose-equation-25ae0286-22c6-4213-8d29-990f72f8df3e");katex.render("E_{2}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-3b9731f3-ce35-4f7f-bc66-f3a415f112a7"><script>var element = document.getElementById("moose-equation-3b9731f3-ce35-4f7f-bc66-f3a415f112a7");katex.render("1.00", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-1a3bf7da-0767-44d3-b618-dbaf1bde7eb9"><script>var element = document.getElementById("moose-equation-1a3bf7da-0767-44d3-b618-dbaf1bde7eb9");katex.render("eV", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">De-trapping Energy, trap 3</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-a59d7bfb-b994-4199-bca8-3311ebe87b94"><script>var element = document.getElementById("moose-equation-a59d7bfb-b994-4199-bca8-3311ebe87b94");katex.render("E_{3}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-acea48e0-1be0-406b-be5f-c4abbe698512"><script>var element = document.getElementById("moose-equation-acea48e0-1be0-406b-be5f-c4abbe698512");katex.render("1.45", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-1fa868b0-81bc-4cc0-acfe-428f008eb9e2"><script>var element = document.getElementById("moose-equation-1fa868b0-81bc-4cc0-acfe-428f008eb9e2");katex.render("eV", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Temperature (implantation and resting)</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-a7522cba-5faf-4093-a6a8-ef7c9fa4a2f9"><script>var element = document.getElementById("moose-equation-a7522cba-5faf-4093-a6a8-ef7c9fa4a2f9");katex.render("T_{\\text{imp}}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-326a5f69-9a83-4dd6-b114-3bf29ad498f3"><script>var element = document.getElementById("moose-equation-326a5f69-9a83-4dd6-b114-3bf29ad498f3");katex.render("300", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-f4a03ebf-3c0e-4dd2-85a0-8649dcf18788"><script>var element = document.getElementById("moose-equation-f4a03ebf-3c0e-4dd2-85a0-8649dcf18788");katex.render("K", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Temperature ramping rate</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-891698b5-b4c0-45fb-bfa2-c3b6ecad985d"><script>var element = document.getElementById("moose-equation-891698b5-b4c0-45fb-bfa2-c3b6ecad985d");katex.render("\\beta", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-8602cd1b-eb9e-4f5a-910f-34edd17e71ca"><script>var element = document.getElementById("moose-equation-8602cd1b-eb9e-4f5a-910f-34edd17e71ca");katex.render("8", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-1ce9c8f9-c7d4-480c-8e8d-3ac8d507b511"><script>var element = document.getElementById("moose-equation-1ce9c8f9-c7d4-480c-8e8d-3ac8d507b511");katex.render("K/s", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Simulation time</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-fb3d0ae4-04a9-4b9a-a605-ca03acd9951a"><script>var element = document.getElementById("moose-equation-fb3d0ae4-04a9-4b9a-a605-ca03acd9951a");katex.render("t_{\\text{sim}}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-53897e80-9045-43a3-ba28-4b6db6439a12"><script>var element = document.getElementById("moose-equation-53897e80-9045-43a3-ba28-4b6db6439a12");katex.render("1.0\\times 10^{-8}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-e0400c5b-1687-4949-886b-ebc87d041c26"><script>var element = document.getElementById("moose-equation-e0400c5b-1687-4949-886b-ebc87d041c26");katex.render("s", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody><tbody><tr><td style=";text-align:left">Extrinsic trap creation rate</td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-959c9931-c567-4619-b9dc-59b5d4f8c792"><script>var element = document.getElementById("moose-equation-959c9931-c567-4619-b9dc-59b5d4f8c792");katex.render("\\mu_a", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-00205c04-8a42-4dd8-ac8d-1e7baec886ec"><script>var element = document.getElementById("moose-equation-00205c04-8a42-4dd8-ac8d-1e7baec886ec");katex.render("1.00\\times 10^{-2}", element, {displayMode:false,throwOnError:false});</script></span></td><td style=";text-align:left"><span class="moose-katex-inline-equation" id="moose-equation-0471891f-76bf-4789-8ffb-2d5ecd683277"><script>var element = document.getElementById("moose-equation-0471891f-76bf-4789-8ffb-2d5ecd683277");katex.render("s^{-1}", element, {displayMode:false,throwOnError:false});</script></span></td></tr></tbody></table></div></div></div><p>Also common between an calculation stages are the surface outflow conditions, for which a dirichlet condition with a zero value is applied to all external surfaces, and the core set of kernels, which  describe the common physics for all Achlys calculaitons; the source term is the only kernel that is  treated differently between calculations.</p></section><section class="scrollspy" id="9bf20ba6-e801-4479-bf07-ff51b865da5e" data-section-level="2" data-section-text="Stage 1 : Implantation"><h2 id="implantation">Stage 1: Implantation</h2><p>In this simulation:</p><ul class="browser-default"><li><p>A gaussian implantation profile is used for the source term </p></li><li><p>A dirichlet boundary condition with a zero value for the surface  concentration of the mobile phase is used for all external surfaces </p></li><li><p>Constant values are used for the densities of two instrisic trap types, labelled trap 1 and trap2. These are uniformly distributed throughout the entire material domain. </p></li><li><p>A third trap is simulated whose concentration increases over time as the material is irradiated. This trap only appears in a narrow region near the surface exposed to particle bombardment.  </p></li><li><p>The temperature is kept at a constant 300 K </p></li><li><p>The total simulation time is 400 s</p></li></ul><section id="4b554af5-9607-403a-bd63-7a92e95e76e4" data-section-level="3" data-section-text="Mesh"><h3 id="mesh">Mesh</h3><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Mesh]
  [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list = true
  [../]
  [./block_1]
    type = AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#4d0cfaaf-dc24-4f39-a8e3-1d0eeebd31d9">(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</a></section><section id="e256d545-8deb-458c-992a-1192afb05357" data-section-level="3" data-section-text="Source term : the implantation profile"><h3 id="source-term-the-implantation-profile">Source term: the implantation profile</h3><p>The implantation profile for the experiment is a function of the composition, energy, and direction of the incident particles. This is generally determined by an external tool such as SRIM. Here a gaussian profile with mean 4.5 nm and standard deviation of 4.5 nm has been used  following <a href="#DELAPORTE2019">Delaporte-Mathurin et al. (2019)</a>. The scale factor applied means units of <span class="moose-katex-inline-equation" id="moose-equation-f75c56f5-111b-4cff-9e24-244acd302c9c"><script>var element = document.getElementById("moose-equation-f75c56f5-111b-4cff-9e24-244acd302c9c");katex.render("m^{-3}", element, {displayMode:false,throwOnError:false});</script></span> are obtained for the source term when the value of the gaussian function is multiplied by the particle flux in <span class="moose-katex-inline-equation" id="moose-equation-83c046ab-a93e-4c98-8307-20179309071a"><script>var element = document.getElementById("moose-equation-83c046ab-a93e-4c98-8307-20179309071a");katex.render("m^{-2}", element, {displayMode:false,throwOnError:false});</script></span>.</p><p>It is also possible to define other profiles (exonweib shown below) or alternatively to read in  values from a CSV file.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#e165a544-bb35-462e-9b31-c4cfe4d96d5f">(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</a></section><section id="d176f8c4-c9d6-432f-b14f-e22c12e3efc7" data-section-level="3" data-section-text="Kernels"><h3 id="kernels">Kernels</h3><p>The kernels shown below represent the standard set for any Achlys calculation. Note only that the  source term has been selected to use the gaussian implantation profile defined above. The &quot;value&quot; field here is the value of the particle flux which has been scaled by the density of solute atoms. For the case of deuterium in tungsten the scale factor is <span class="moose-katex-inline-equation" id="moose-equation-d4b4e25c-b7ed-45ba-9e38-a3902bc7b75f"><script>var element = document.getElementById("moose-equation-d4b4e25c-b7ed-45ba-9e38-a3902bc7b75f");katex.render("6.3 \\times 10^{28}", element, {displayMode:false,throwOnError:false});</script></span> and the  units are <span class="moose-katex-inline-equation" id="moose-equation-63b821f4-4515-4022-b420-97ab772f9fd2"><script>var element = document.getElementById("moose-equation-63b821f4-4515-4022-b420-97ab772f9fd2");katex.render("(D/W)m^{-2}", element, {displayMode:false,throwOnError:false});</script></span>.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Kernels]
  [./H3_source]
    type = ADBodyForce
    variable = Mobile
    value = 4e-10
    function = Gaussian_implant
  []
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#d62a0db1-6f02-46fd-920c-74941f23b491">(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</a></section><section id="d65bcc52-9b86-4fa8-b188-1b5df4a15430" data-section-level="3" data-section-text="Material Properties"><h3 id="material-properties">Material Properties</h3><p>A specific material class has been developed to model the transient evolution of extrinsic traps that is used in this calculation. The example inputs for the  <a href="../../../source/materials/ExtrinsicTransientTrappingMaterial2.html">ExtrinsicTransientTrappingMaterial</a> class are shown below.</p><p>Using this class means that the density of availble type-3 traps increases over time within this simulation stage. The rate of increase depends on the flux, whose shape is defined by the &quot;function&quot; parameter and whose magnitude is given by the &quot;flux&quot; field.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Materials]
  [./implant]
    type = ExtrinsicTransientTrappingMaterial2
    # Energies    
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
    # pre-exponential rate constants    
    v0 = 1e13
    D0 = 4.1e-7
    lambda = 1.1E-10
    # unused    
    rho = 1 # unecessary scaling factor, do not use
    # site densities    
    n_sol = 6
    n1 = 1e-3
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
    # trap creation rates    
    eta_a = 6e-4
    eta_b = 2e-4
    # flux distribution parameters    
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
    #Temperature    
    const_T = 300
    block = &#x27;Tungsten&#x27;
    # thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#4a358851-e765-4c13-9953-11b0c17b7f45">(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</a></section><section id="4ee04746-fdda-40e1-a912-bd792f0271a4" data-section-level="3" data-section-text="Boundary Conditions"><h3 id="boundary-conditions">Boundary Conditions</h3><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[BCs]
  [./PFC]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#612c9f23-6640-424c-8778-fe012a2cd829">(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</a></section><section id="55565053-5f09-4d30-aa37-4d5bc2054cbd" data-section-level="3" data-section-text="Executioner"><h3 id="executioner">Executioner</h3><p>There are 3 things to note within this input block:</p><ul class="browser-default"><li><p>The total simulation time is set by the end_time parameter. This is where we specify the duration of the implantation phase </p></li><li><p>Adaptive timestepping is used to achieve the most efficient time-steps. </p></li><li><p>PetSc allows any numerical scheme to be substituted here to carry out the solve. Here a bi-conjugate gradient linear method with LU preconditioner and second-order time integration has been used.</p></li></ul><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling = True
  #  compute_scaling_once=False
  #  scaling_group_variables = &#x27;Trapped_3 Trapped_2 Trapped_1 Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_max_its = 100
  nl_max_funcs = 7
  #  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29
  # Set PETSc parameters to optimize solver efficiency
  timestep_tolerance = 0.01
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 400
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.2
    dt = 5e-4
  []
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#12945aca-bb19-496e-bf73-af107456af82">(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</a></section><section id="14fb4fd9-ec51-45cb-81f2-3419d859a71c" data-section-level="3" data-section-text="Visualising implantation"><h3 id="visualising-implantation">Visualising implantation</h3><p>The implantation step of this calculation can be run as a standalone simulation. The input file can be run by passing it&#x27;s path using the &quot;-i&quot; flag  as shown below; outputs will be written to the same folder in which the input is located.</p><pre class="moose-pre"><code class="language-text">
achlys_exe=~/projects/achlys/achlys-opt
input_file=~/projects/achlys/problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i
./achlys-opt -i $input_file
</code></pre><p>Paraview can be used to visualise the resulting exodus file.  in addition the total quantities of deuterium in each phase  will be written to a csv file at each timestep. </p></section></section><section class="scrollspy" id="619aac01-6f9f-4576-aa5c-df9de7926af9" data-section-level="2" data-section-text="Stage 2 : Resting"><h2 id="resting">Stage 2: Resting</h2><p>In this stage:</p><ul class="browser-default"><li><p>The source term is switched off so no new particles are implanted </p></li><li><p>The creation of new type-3 traps also stops when the implantation flux stops meaning the concentration and distribution of traps remains static from the end of implantation </p></li><li><p>Desorption continues to occur from the external surfaces, though this is limited due to the low temperature; the boundary condition remains a zero-valued dirichlet condition </p></li><li><p>The temperature is a constant 300 K </p></li><li><p>The total resting time is 50 s</p></li></ul><section id="47587b55-0e30-4ef5-81c7-5b37e861a13e" data-section-level="3" data-section-text="Kernels"><h3 id="kernels">Kernels</h3><p>The Kernels here are the standard set for Achlys calculations.  Note only that the source term has now been removed for the resting phase.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#d7a2f5ec-aebc-41d4-adb6-125e8e0ebc79">(problems/thermal_desorption/ogorodnikova/tds_multiapp/resting_multi.i)</a></section><section id="a9d9b370-564c-41c4-ae2d-eed58f846e7a" data-section-level="3" data-section-text="Material Properties"><h3 id="material-properties">Material Properties</h3><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Materials]
  [./implant]
    type = ExtrinsicStaticTrappingMaterial
    # Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
    # pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
    # unused
    rho = 1 # unecessary scaling factor, do not use
    # site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
    # trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
    # flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
    #Temperature
    const_T = 300
    block = &#x27;Tungsten&#x27; #&#x27;Implantation_region&#x27;
    # thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#1ac6702f-ed9a-4568-bd73-a631760269c9">(problems/thermal_desorption/ogorodnikova/tds_multiapp/resting_multi.i)</a></section><section id="776fddcf-c931-4c92-b634-e7cec3e48175" data-section-level="3" data-section-text="Boundary Conditions"><h3 id="boundary-conditions">Boundary Conditions</h3><p>During resting the mobile concentration at the surface is considered to be zero. <a href="https://mooseframework.inl.gov/source/bcs/ADDirichletBC.html">Dirichlet conditions</a> are applied at both surfaces.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[BCs]
  [./desorption]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type = ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#98273b7e-b3a0-4c6c-8380-3a209ff3ade3">(problems/thermal_desorption/ogorodnikova/tds_multiapp/resting_multi.i)</a></section></section><section class="scrollspy" id="dafbb1c5-9804-4b29-9143-fb047fddba12" data-section-level="2" data-section-text="Stage 3 : Desorption"><h2 id="desorption">Stage 3: Desorption</h2><p>In this stage:</p><ul class="browser-default"><li><p>The temperature is raised at a constant rate of 8 K/s. </p></li><li><p>The boundary condition remains a zero-valued dirichlet condition. </p></li><li><p>The concentration and distribution of traps remains static. This state is unchanged from the end of the implantation calculation. </p></li><li><p>The rate of desorption from each surface is measured using the ADSideFluxIntegral postprocessor and results are written to a CSV file.</p></li></ul><section id="32ce0e21-facd-49cc-94e9-71827882f4d6" data-section-level="3" data-section-text="Kernels"><h3 id="kernels">Kernels</h3><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#572892eb-62cd-46a1-be46-b26e911130c1">(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</a></section><section id="8a1b3cbf-738f-4c05-a45e-5e4391b861be" data-section-level="3" data-section-text="Material Properties"><h3 id="material-properties">Material Properties</h3><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Materials]
  [./implant]
    type = ExtrinsicStaticTrappingMaterialRampingT
    # Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.50
    k_boltz = 8.617333E-5
    # pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
    # unused
    rho = 1 # unecessary scaling factor, do not use
    # site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
    # trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
    # flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
    #Temperature
    initial_T = 300
    beta = 8
    block = &#x27;Tungsten&#x27; # &#x27;Stopping_zone&#x27; # Plastic_region
    # thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#c11c7982-6e49-4db8-a55b-822f63a3b1e1">(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</a></section><section id="4ffcc8ab-799a-4a21-b943-cbe1715cf0d2" data-section-level="3" data-section-text="Boundary Conditions"><h3 id="boundary-conditions">Boundary Conditions</h3><p>For the desorption phase the mobile concentration at the surface is considered to be zero.  <a href="https://mooseframework.inl.gov/source/bcs/ADDirichletBC.html">Dirichlet conditions</a>  are applied at both surfaces.</p><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[BCs]
  [./desorption]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type = ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#ba02894d-881d-4ec4-8ba8-29bcccfe5a8e">(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</a></section><section id="a9909162-1b41-403f-b386-af577478653e" data-section-level="3" data-section-text="Outputs"><h3 id="outputs">Outputs</h3><pre class="moose-pre" style="max-height:350px;"><code class="language-text">[Postprocessors]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
  [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
[]

[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
</code></pre><a class="moose-source-filename tooltipped modal-trigger" href="#7d1d7c66-cae0-4563-b595-832d123bb543">(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</a><p></p></section></section><section class="scrollspy" id="af8d7fdd-b199-4933-a6f9-ceff42210902" data-section-level="2" data-section-text="References"><h2 id="references">References</h2><div class="moose-bibliography"><ol><li id="DELAPORTE2019">Rmi Delaporte-Mathurin, Etienne&nbsp;A. Hodille, Jonathan Mougenot, Yann Charles, and Christian Grisolia.
Finite element analysis of hydrogen retention in iter plasma facing components using festim.
<em>Nuclear Materials and Energy</em>, 21:100709, 2019.
URL: <a href="https://www.sciencedirect.com/science/article/pii/S2352179119300547">https://www.sciencedirect.com/science/article/pii/S2352179119300547</a>, <a href="https://doi.org/https://doi.org/10.1016/j.nme.2019.100709">doi:https://doi.org/10.1016/j.nme.2019.100709</a>.<a href="#18ac2c83-4529-42b5-b188-27b0f0017d3d" class="modal-trigger moose-bibtex-modal" style="padding-left:10px;">[BibTeX]</a><div class="modal" id="18ac2c83-4529-42b5-b188-27b0f0017d3d"><div class="modal-content"><pre style="line-height:1.25;"><code class="language-latex">@article{DELAPORTE2019,
    author = "Delaporte-Mathurin, Rmi and Hodille, Etienne A. and Mougenot, Jonathan and Charles, Yann and Grisolia, Christian",
    title = "Finite element analysis of hydrogen retention in ITER plasma facing components using FESTIM",
    journal = "Nuclear Materials and Energy",
    volume = "21",
    pages = "100709",
    year = "2019",
    issn = "2352-1791",
    doi = "https://doi.org/10.1016/j.nme.2019.100709",
    url = "https://www.sciencedirect.com/science/article/pii/S2352179119300547",
    keywords = "Fusion, Tritium, Finite elements, Plasma facing components, Hydrogen isotopes",
    abstract = "The behaviour of hydrogen isotopes in ITER monoblocks was studied using the code FESTIM (Finite Element Simulation of Tritium In Materials) which is introduced in this publication. FESTIM has been validated by reproducing experimental data and the Method of Manufactured Solutions was used for analytical verification. Following relevant plasma scenarios, both transient heat transfer and hydrogen isotopes (HIs) diffusion have been simulated in order to assess HIs retention in monoblocks. Relevant materials properties have been used. Each plasma cycle is composed of a current ramp up, a current plateau, a current ramp down and a resting phase before the following shot. 100 cycles are simulated. The total HIs inventory in the tokamak during resting phases reaches 1.8103mg whereas during the implantation phases it keeps increasing as a power law of time. Particle flux on the cooling channel of the monoblock is also computed. The breakthrough time is estimated to be t=1105s which corresponds to 24 cycles. Relevance of 2D modelling has been demonstrated by comparing the total HIs inventory obtained by 2D and 1D simulations. Using 1D simulations, a relative error is observed compared to 2D simulations which can reach -25\% during the resting phase. The error during implantation phases keeps increasing."
}
</code></pre></div></div></li><li id="OGOROD2003">O.V Ogorodnikova, J&nbsp;Roth, and M&nbsp;Mayer.
Deuterium retention in tungsten in dependence of the surface conditions.
<em>Journal of Nuclear Materials</em>, 313-316:469&ndash;477, 2003.
Plasma-Surface Interactions in Controlled Fusion Devices 15.
URL: <a href="https://www.sciencedirect.com/science/article/pii/S0022311502013752">https://www.sciencedirect.com/science/article/pii/S0022311502013752</a>, <a href="https://doi.org/https://doi.org/10.1016/S0022-3115(02)01375-2">doi:https://doi.org/10.1016/S0022-3115(02)01375-2</a>.<a href="#bfff687a-3ca9-4543-8d22-d0a149285c66" class="modal-trigger moose-bibtex-modal" style="padding-left:10px;">[BibTeX]</a><div class="modal" id="bfff687a-3ca9-4543-8d22-d0a149285c66"><div class="modal-content"><pre style="line-height:1.25;"><code class="language-latex">@article{OGOROD2003,
    author = "Ogorodnikova, O.V and Roth, J and Mayer, M",
    title = "Deuterium retention in tungsten in dependence of the surface conditions",
    journal = "Journal of Nuclear Materials",
    volume = "313-316",
    pages = "469-477",
    year = "2003",
    note = "Plasma-Surface Interactions in Controlled Fusion Devices 15",
    issn = "0022-3115",
    doi = "https://doi.org/10.1016/S0022-3115(02)01375-2",
    url = "https://www.sciencedirect.com/science/article/pii/S0022311502013752",
    keywords = "Deuterium, Tungsten, Retention, Implantation",
    abstract = "The paper reviews hydrogen isotope retention and migration in tungsten (W). Due to a large scatter of the deuterium (D) retention database, new measurements of ion-driven D retention in polycrystalline W foil have been performed to clarify the mechanism of hydrogen isotope inventory in W. Deuterium retention has been investigated as a function of ion fluence, implantation temperature, incident energy and surface conditions. Special attention has been given on the investigation of D retention in thin films of tungsten carbide and tungsten oxide which can be formed on W surface in a fusion device. Such kinds of films increase the D retention in W. Several points are reviewed: (i) inventory in pure W, (ii) inventory in W pre-implanted by carbon ions and (iii) inventory in tungsten oxide."
}
</code></pre></div></div></li></ol></div></section></section><div class="moose-modal modal" id="61fae360-9d80-47b9-b8b3-a1b92eda2e2b"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
  [../]
  [./Trapped_1]
  [../]
  [./Trapped_2]
  []
  [./Trapped_3]
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;resting_multi.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterialRampingT
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.50
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    initial_T = 300
    beta = 8
    block = &#x27;Tungsten&#x27; # &#x27;Stopping_zone&#x27; # Plastic_region
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../] 
[]
[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling_once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
 # l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
  #nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
#  dt = 0.25 #0.001 #5e-2
  end_time = 62.5
  timestep_tolerance = 0.01
    [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 5
    cutback_factor = 0.5
    growth_factor = 1.1
    dt = 0.1
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="4d0cfaaf-dc24-4f39-a8e3-1d0eeebd31d9"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled] 
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_comdition = 0.0
    scaling = 1e2
  [../]
  [./Trapped_2]
    initial_condition = 0.0
    scaling = 1e3
  []
  [./Trapped_3]
    initial_condition = 0.0
    scaling = 1e3
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]


[Kernels]
  [./H3_source]
    type = ADBodyForce
    variable = Mobile
    value = 4e-10
    function = Gaussian_implant
  []
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative 
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative 
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[BCs]
  [./PFC]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicTransientTrappingMaterial2
# Energies    
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants    
    v0 = 1e13 
    D0 = 4.1e-7
    lambda = 1.1E-10
# unused    
    rho = 1 # unecessary scaling factor, do not use
# site densities    
    n_sol = 6
    n1 = 1e-3
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates    
    eta_a = 6e-4
    eta_b = 2e-4
# flux distribution parameters    
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature    
    const_T = 300
    block = &#x27;Tungsten&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Postprocessors]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON 
  scheme = bdf2
  automatic_scaling=True
#  compute_scaling_once=False
#  scaling_group_variables = &#x27;Trapped_3 Trapped_2 Trapped_1 Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29
  
  # Set PETSc parameters to optimize solver efficiency
  timestep_tolerance = 0.01
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 400
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.2
    dt = 5e-4
  []
[]

[Preconditioning]
  [./smp]
    type = SMP
    full = true
  [../]
[]


[Outputs]
  exodus = true
  csv = true
#  console = false
[]

[Debug]
#  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="e165a544-bb35-462e-9b31-c4cfe4d96d5f"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled] 
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_comdition = 0.0
    scaling = 1e2
  [../]
  [./Trapped_2]
    initial_condition = 0.0
    scaling = 1e3
  []
  [./Trapped_3]
    initial_condition = 0.0
    scaling = 1e3
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]


[Kernels]
  [./H3_source]
    type = ADBodyForce
    variable = Mobile
    value = 4e-10
    function = Gaussian_implant
  []
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative 
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative 
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[BCs]
  [./PFC]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicTransientTrappingMaterial2
# Energies    
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants    
    v0 = 1e13 
    D0 = 4.1e-7
    lambda = 1.1E-10
# unused    
    rho = 1 # unecessary scaling factor, do not use
# site densities    
    n_sol = 6
    n1 = 1e-3
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates    
    eta_a = 6e-4
    eta_b = 2e-4
# flux distribution parameters    
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature    
    const_T = 300
    block = &#x27;Tungsten&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Postprocessors]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON 
  scheme = bdf2
  automatic_scaling=True
#  compute_scaling_once=False
#  scaling_group_variables = &#x27;Trapped_3 Trapped_2 Trapped_1 Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29
  
  # Set PETSc parameters to optimize solver efficiency
  timestep_tolerance = 0.01
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 400
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.2
    dt = 5e-4
  []
[]

[Preconditioning]
  [./smp]
    type = SMP
    full = true
  [../]
[]


[Outputs]
  exodus = true
  csv = true
#  console = false
[]

[Debug]
#  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d62a0db1-6f02-46fd-920c-74941f23b491"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled] 
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_comdition = 0.0
    scaling = 1e2
  [../]
  [./Trapped_2]
    initial_condition = 0.0
    scaling = 1e3
  []
  [./Trapped_3]
    initial_condition = 0.0
    scaling = 1e3
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]


[Kernels]
  [./H3_source]
    type = ADBodyForce
    variable = Mobile
    value = 4e-10
    function = Gaussian_implant
  []
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative 
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative 
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[BCs]
  [./PFC]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicTransientTrappingMaterial2
# Energies    
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants    
    v0 = 1e13 
    D0 = 4.1e-7
    lambda = 1.1E-10
# unused    
    rho = 1 # unecessary scaling factor, do not use
# site densities    
    n_sol = 6
    n1 = 1e-3
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates    
    eta_a = 6e-4
    eta_b = 2e-4
# flux distribution parameters    
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature    
    const_T = 300
    block = &#x27;Tungsten&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Postprocessors]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON 
  scheme = bdf2
  automatic_scaling=True
#  compute_scaling_once=False
#  scaling_group_variables = &#x27;Trapped_3 Trapped_2 Trapped_1 Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29
  
  # Set PETSc parameters to optimize solver efficiency
  timestep_tolerance = 0.01
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 400
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.2
    dt = 5e-4
  []
[]

[Preconditioning]
  [./smp]
    type = SMP
    full = true
  [../]
[]


[Outputs]
  exodus = true
  csv = true
#  console = false
[]

[Debug]
#  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="4a358851-e765-4c13-9953-11b0c17b7f45"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled] 
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_comdition = 0.0
    scaling = 1e2
  [../]
  [./Trapped_2]
    initial_condition = 0.0
    scaling = 1e3
  []
  [./Trapped_3]
    initial_condition = 0.0
    scaling = 1e3
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]


[Kernels]
  [./H3_source]
    type = ADBodyForce
    variable = Mobile
    value = 4e-10
    function = Gaussian_implant
  []
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative 
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative 
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[BCs]
  [./PFC]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicTransientTrappingMaterial2
# Energies    
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants    
    v0 = 1e13 
    D0 = 4.1e-7
    lambda = 1.1E-10
# unused    
    rho = 1 # unecessary scaling factor, do not use
# site densities    
    n_sol = 6
    n1 = 1e-3
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates    
    eta_a = 6e-4
    eta_b = 2e-4
# flux distribution parameters    
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature    
    const_T = 300
    block = &#x27;Tungsten&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Postprocessors]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON 
  scheme = bdf2
  automatic_scaling=True
#  compute_scaling_once=False
#  scaling_group_variables = &#x27;Trapped_3 Trapped_2 Trapped_1 Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29
  
  # Set PETSc parameters to optimize solver efficiency
  timestep_tolerance = 0.01
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 400
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.2
    dt = 5e-4
  []
[]

[Preconditioning]
  [./smp]
    type = SMP
    full = true
  [../]
[]


[Outputs]
  exodus = true
  csv = true
#  console = false
[]

[Debug]
#  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="612c9f23-6640-424c-8778-fe012a2cd829"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled] 
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_comdition = 0.0
    scaling = 1e2
  [../]
  [./Trapped_2]
    initial_condition = 0.0
    scaling = 1e3
  []
  [./Trapped_3]
    initial_condition = 0.0
    scaling = 1e3
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]


[Kernels]
  [./H3_source]
    type = ADBodyForce
    variable = Mobile
    value = 4e-10
    function = Gaussian_implant
  []
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative 
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative 
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[BCs]
  [./PFC]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicTransientTrappingMaterial2
# Energies    
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants    
    v0 = 1e13 
    D0 = 4.1e-7
    lambda = 1.1E-10
# unused    
    rho = 1 # unecessary scaling factor, do not use
# site densities    
    n_sol = 6
    n1 = 1e-3
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates    
    eta_a = 6e-4
    eta_b = 2e-4
# flux distribution parameters    
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature    
    const_T = 300
    block = &#x27;Tungsten&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Postprocessors]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON 
  scheme = bdf2
  automatic_scaling=True
#  compute_scaling_once=False
#  scaling_group_variables = &#x27;Trapped_3 Trapped_2 Trapped_1 Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29
  
  # Set PETSc parameters to optimize solver efficiency
  timestep_tolerance = 0.01
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 400
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.2
    dt = 5e-4
  []
[]

[Preconditioning]
  [./smp]
    type = SMP
    full = true
  [../]
[]


[Outputs]
  exodus = true
  csv = true
#  console = false
[]

[Debug]
#  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="12945aca-bb19-496e-bf73-af107456af82"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/implant_sub.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled] 
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_comdition = 0.0
    scaling = 1e2
  [../]
  [./Trapped_2]
    initial_condition = 0.0
    scaling = 1e3
  []
  [./Trapped_3]
    initial_condition = 0.0
    scaling = 1e3
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]


[Kernels]
  [./H3_source]
    type = ADBodyForce
    variable = Mobile
    value = 4e-10
    function = Gaussian_implant
  []
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative 
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative 
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative 
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[BCs]
  [./PFC]
    type = ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicTransientTrappingMaterial2
# Energies    
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants    
    v0 = 1e13 
    D0 = 4.1e-7
    lambda = 1.1E-10
# unused    
    rho = 1 # unecessary scaling factor, do not use
# site densities    
    n_sol = 6
    n1 = 1e-3
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates    
    eta_a = 6e-4
    eta_b = 2e-4
# flux distribution parameters    
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature    
    const_T = 300
    block = &#x27;Tungsten&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Postprocessors]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON 
  scheme = bdf2
  automatic_scaling=True
#  compute_scaling_once=False
#  scaling_group_variables = &#x27;Trapped_3 Trapped_2 Trapped_1 Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29
  
  # Set PETSc parameters to optimize solver efficiency
  timestep_tolerance = 0.01
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 400
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.2
    dt = 5e-4
  []
[]

[Preconditioning]
  [./smp]
    type = SMP
    full = true
  [../]
[]


[Outputs]
  exodus = true
  csv = true
#  console = false
[]

[Debug]
#  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="d7a2f5ec-aebc-41d4-adb6-125e8e0ebc79"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/resting_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_condition = 0.0
  [../]
  [./Trapped_2]
    initial_condition = 0.0
  []
  [./Trapped_3]
    initial_condition = 0.0
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;implant_sub.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterial
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    const_T = 300
    block = &#x27;Tungsten&#x27; #&#x27;Implantation_region&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling-once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 50
  timestep_tolerance = 0.01
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.5
    dt = 0.05
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="1ac6702f-ed9a-4568-bd73-a631760269c9"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/resting_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_condition = 0.0
  [../]
  [./Trapped_2]
    initial_condition = 0.0
  []
  [./Trapped_3]
    initial_condition = 0.0
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;implant_sub.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterial
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    const_T = 300
    block = &#x27;Tungsten&#x27; #&#x27;Implantation_region&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling-once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 50
  timestep_tolerance = 0.01
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.5
    dt = 0.05
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="98273b7e-b3a0-4c6c-8380-3a209ff3ade3"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/resting_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
    initial_condition = 0.0
  [../]
  [./Trapped_1]
    initial_condition = 0.0
  [../]
  [./Trapped_2]
    initial_condition = 0.0
  []
  [./Trapped_3]
    initial_condition = 0.0
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;implant_sub.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterial
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.5
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    const_T = 300
    block = &#x27;Tungsten&#x27; #&#x27;Implantation_region&#x27;
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../]
[]

[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling-once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
  l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
#  nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
  end_time = 50
  timestep_tolerance = 0.01
  [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 4
    cutback_factor = 0.8
    growth_factor = 1.5
    dt = 0.05
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="572892eb-62cd-46a1-be46-b26e911130c1"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
  [../]
  [./Trapped_1]
  [../]
  [./Trapped_2]
  []
  [./Trapped_3]
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;resting_multi.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterialRampingT
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.50
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    initial_T = 300
    beta = 8
    block = &#x27;Tungsten&#x27; # &#x27;Stopping_zone&#x27; # Plastic_region
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../] 
[]
[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling_once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
 # l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
  #nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
#  dt = 0.25 #0.001 #5e-2
  end_time = 62.5
  timestep_tolerance = 0.01
    [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 5
    cutback_factor = 0.5
    growth_factor = 1.1
    dt = 0.1
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="c11c7982-6e49-4db8-a55b-822f63a3b1e1"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
  [../]
  [./Trapped_1]
  [../]
  [./Trapped_2]
  []
  [./Trapped_3]
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;resting_multi.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterialRampingT
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.50
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    initial_T = 300
    beta = 8
    block = &#x27;Tungsten&#x27; # &#x27;Stopping_zone&#x27; # Plastic_region
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../] 
[]
[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling_once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
 # l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
  #nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
#  dt = 0.25 #0.001 #5e-2
  end_time = 62.5
  timestep_tolerance = 0.01
    [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 5
    cutback_factor = 0.5
    growth_factor = 1.1
    dt = 0.1
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="ba02894d-881d-4ec4-8ba8-29bcccfe5a8e"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
  [../]
  [./Trapped_1]
  [../]
  [./Trapped_2]
  []
  [./Trapped_3]
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;resting_multi.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterialRampingT
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.50
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    initial_T = 300
    beta = 8
    block = &#x27;Tungsten&#x27; # &#x27;Stopping_zone&#x27; # Plastic_region
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../] 
[]
[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling_once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
 # l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
  #nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
#  dt = 0.25 #0.001 #5e-2
  end_time = 62.5
  timestep_tolerance = 0.01
    [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 5
    cutback_factor = 0.5
    growth_factor = 1.1
    dt = 0.1
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div><div class="moose-modal modal" id="7d1d7c66-cae0-4563-b595-832d123bb543"><div class="modal-content"><h4>(problems/thermal_desorption/ogorodnikova/tds_multiapp/desorp_multi.i)</h4><pre class="moose-pre"><code class="language-text">[Mesh]
 [./unlabelled]
    file = /Users/sdixon/projects/blue_kite/problems/thermal_desorption/optimisation/ogorodnikova_1k.msh
    type = FileMeshGenerator
    construct_side_list_from_node_list=true
  [../]
  [./block_1]
    type= AllSideSetsByNormalsGenerator
    input = unlabelled
    #fixed_normal = false
  [../]
[]

[Problem]
  type = FEProblem # This is the &quot;normal&quot; type of Finite Element Problem in MOOSE
  coord_type = XYZ # cartesian
[]

[Variables]
  [./Mobile]
  [../]
  [./Trapped_1]
  [../]
  [./Trapped_2]
  []
  [./Trapped_3]
  []
[]

[Functions]
  [./dts]
    type = PiecewiseLinear
    x = &#x27;0 1e-4 5e-4 1e-3&#x27;
    y = &#x27;1e-4 1e-4 5e-4 5e-4&#x27;
  [../]
  [./Gaussian_implant]
    type = ParsedFunction
    value = &#x27;scale * exp( -0.5 * ((x - mean) / sd)^2)&#x27;
    vars = &#x27;scale mean sd&#x27;
    vals = &#x27;0.93e8 4.5e-9 4.5e-9&#x27;
  [../]
  [./Exponweib_implant]
    type = ParsedFunction
    value = &#x27;peak * (a * c / scale) * (( 1 - exp(-1 * (((x*1e9)-loc)/scale)^c))^(a-1) ) * exp(-1 * (((x*1e9)-loc)/scale)^c)*(((x*1e9)-loc)/scale)^(c-1)&#x27;
    vars = &#x27;peak a c loc scale&#x27;
    vals = &#x27;5.82e8 0.90 1.96 -0.013 4.909&#x27;
  [../]
[]

[MultiApps]
  [sub_app]
    type = FullSolveMultiApp
    #app_type = BlueKiteApp
    input_files = &#x27;resting_multi.i&#x27;
   # positions = &#x27;0   0.029   0
   #              0.015 0.0.029 0
   #              0.015 0.014 0
   #              0.0 0.014 0&#x27;
  execute_on = INITIAL
  clone_master_mesh = true
  []
[]

[Transfers]
#   [to_sub] 
#    type = MultiAppCopyTransfer
#    multi_app = sub_app
#    source_variable = &#x27;surface_temp&#x27;
#    variable = &#x27;surface_temp&#x27;
#    direction = to_multiapp
#  []
  [mobile_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Mobile&#x27;
    variable = &#x27;Mobile&#x27;
    direction = from_multiapp
  []
  [trap_1_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_1&#x27;
    variable = &#x27;Trapped_1&#x27;
    direction = from_multiapp
  []
  [trap_2_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_2&#x27;
    variable = &#x27;Trapped_2&#x27;
    direction = from_multiapp
  []
  [trap_3_transfer]
    type =  MultiAppCopyTransfer #MultiAppScalarToAuxScalarTransfer
    multi_app = sub_app
    source_variable = &#x27;Trapped_3&#x27;
    variable = &#x27;Trapped_3&#x27;
    direction = from_multiapp
  []
[]

[Kernels]
  [./H3_diffusion_eq1]
    type = ADMatDiffusion
    variable = Mobile
    Diffusivity = D
  [../]
  [./mobile_time_deriv]
    type = ADTimeDerivative
    variable = Mobile
  [../]
  [./trapping_equilibrium_equation1]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_1
    v = Mobile
    n_traps = n1
    vi = V1
  [../]
  [./trapping_equilibrium_equation2]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_2
    v = Mobile
    n_traps = n2
    vi = V2
  [../]
  [./trapping_equilibrium_equation3]
    type = ADTrappingEquilibriumEquation
    variable = Trapped_3
    v = Mobile
    n_traps = n3
    vi = V3
  [../]
  [./trapped_time_deriv_couple]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_1
  [../]
  [./trapped_time_deriv_couple2]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_2
  [../]
  [./trapped_time_deriv_couple3]
    type = ADCoupledTimeDerivative
    variable = Mobile
    v = Trapped_3
  [../]
  [./trapped_time_deriv]
    type = ADTimeDerivative
    variable = Trapped_1
  [../]     
  [./trapped_time_deriv2]
    type = ADTimeDerivative
    variable = Trapped_2
  [../]
  [./trapped_time_deriv3]
    type = ADTimeDerivative
    variable = Trapped_3
  [../]
[]

[Postprocessors]
  [/pfc_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 1
    diffusivity = D
  [../]
  [/back_flux]
    type = ADSideFluxIntegral
    variable = Mobile
    boundary = 2
    diffusivity = D
  [../]
  [./total_mobile]
    type = VariableIntegral
    variable = Mobile
  [../]
  [./total_trap_1]
    type = VariableIntegral
    variable = Trapped_1
  [../]
    [./total_trap_2]
    type = VariableIntegral
    variable = Trapped_2
  [../]
  [./total_trap_3]
    type = VariableIntegral
    variable = Trapped_3
  [../]
[]

[BCs]
  [./desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 1
    value = 0
  [../]
  [./back_desorption]
    type =  ADDirichletBC
    variable = Mobile
    boundary = 2
    value = 0
  [../]
[]

[Materials]
   [./implant]
    type = ExtrinsicStaticTrappingMaterialRampingT
# Energies
    E_diff = 0.39
    E1 = 0.87
    E2 = 1.0
    E3 = 1.50
    k_boltz = 8.617333E-5
# pre-exponential rate constants
    v0 = 1.0E13
    D0 = 4.1E-7
    lambda = 1.1E-10
# unused
    rho = 1 # unecessary scaling factor, do not use
# site densities
    n_sol = 6
    n1 = 1E-3 #1.0E25
    n2 = 4e-4
    n3a_max = 1e-1
    n3b_max = 1e-2
# trap creation rates
    eta_a = 6e-4
    eta_b = 2e-4
    trap_evolution_time = 400
# flux distribution parameters
    flux = 4e-10
    function = Gaussian_implant
    xp = 1e-6
#Temperature
    initial_T = 300
    beta = 8
    block = &#x27;Tungsten&#x27; # &#x27;Stopping_zone&#x27; # Plastic_region
# thermal properties
    conductivity = 150 # W/K
    Cp = 137 # J/(kg K)
    density = 19300 # kg/m3
  [../] 
[]
[Executioner]
  type = Transient
  solve_type = NEWTON
  scheme = bdf2
  automatic_scaling=True
 compute_scaling_once=False
  scaling_group_variables = &#x27;Trapped_3; Trapped_2; Trapped_1; Mobile&#x27;
  resid_vs_jac_scaling_param = 0.8
 # l_tol = 1e-4
  l_max_its = 100
  nl_max_funcs = 7
  #nl_rel_tol = 1e-7
  nl_abs_tol = 1e-29

  # Set PETSc parameters to optimize solver efficiency
  petsc_options_iname = &#x27;-ksp_type -pc_type -pc_factor_shift_type&#x27;
  petsc_options_value = &#x27;bcgs lu  NONZERO&#x27;
#  dt = 0.25 #0.001 #5e-2
  end_time = 62.5
  timestep_tolerance = 0.01
    [TimeStepper]
    type = IterationAdaptiveDT
    optimal_iterations = 5
    cutback_factor = 0.5
    growth_factor = 1.1
    dt = 0.1
  []
[]


[Outputs]
  #execute_on = &#x27;timestep_end&#x27;
  exodus = false # Output Exodus format
  csv = true
[]
[Debug]
  show_material_props = true
  show_var_residual_norms = true
[]
</code></pre></div><div class="modal-footer"><a class="modal-close btn-flat">Close</a></div></div></div><div class="col hide-on-med-and-down l2"><div class="toc-wrapper pin-top"><ul class="section table-of-contents"><li><a href="#c78e5c08-9f0b-4049-9856-32a42a4e648d" class="tooltipped" data-position="left" data-tooltip="Multiapp">Multiapp</a></li><li><a href="#875e0d61-f6ef-4cbd-b717-df353dfb8845" class="tooltipped" data-position="left" data-tooltip="Common parameters">Common parameters</a></li><li><a href="#9bf20ba6-e801-4479-bf07-ff51b865da5e" class="tooltipped" data-position="left" data-tooltip="Stage 1 : Implantation">Stage 1 : Implantation</a></li><li><a href="#619aac01-6f9f-4576-aa5c-df9de7926af9" class="tooltipped" data-position="left" data-tooltip="Stage 2 : Resting">Stage 2 : Resting</a></li><li><a href="#dafbb1c5-9804-4b29-9143-fb047fddba12" class="tooltipped" data-position="left" data-tooltip="Stage 3 : Desorption">Stage 3 : Desorption</a></li><li><a href="#af8d7fdd-b199-4933-a6f9-ceff42210902" class="tooltipped" data-position="left" data-tooltip="References">References</a></li></ul></div></div></div></div></main></div></body><script type="text/javascript" src="../../../contrib/materialize/materialize.min.js"></script><script type="text/javascript" src="../../../contrib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="../../../contrib/prism/prism.min.js"></script><script type="text/javascript" src="../../../js/init.js"></script><script type="text/javascript" src="../../../js/navigation.js"></script><script type="text/javascript" src="../../../contrib/fuse/fuse.min.js"></script><script type="text/javascript" src="../../../js/search_index.js"></script><script type="text/javascript" src="../../../js/sqa_moose.js"></script>